var gulp = require("gulp");
var phpunit    = require('gulp-phpunit');
var uglify = require("gulp-uglify");
var rename = require("gulp-rename");
var karma = require("karma").server;
var jasmine = require("gulp-jasmine");

elixir(function(mix) {
    mix.phpUnit([] , path.normalize('vendor/bin/phpunit') + ' --verbose');
});

gulp.task("test-browser", ["minify"], function(callback){
    karma.start({
        configFile: process.cwd() + '/config/karma.conf.js'
    }, callback);
});

gulp.task("test-node", ["minify"], function(){
    return gulp.src('test/*')
        .pipe(jasmine());
});

gulp.task('phpunit', function() {
  var options = {debug: false};
  gulp.src('phpunit.xml')
    .pipe(phpunit('./vendor/bin/phpunit',options));
});

gulp.task("test", ["test-browser", "test-node"]);

gulp.task("minify", function(){
    return gulp.src("lodash-deep.js")
        .pipe(uglify())
        .pipe(rename("lodash-deep.min.js"))
        .pipe(gulp.dest("./"));
});
